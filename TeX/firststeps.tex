\chapter{Preparation}
\label{sec:firststeps}

\section{Initial Researches}
Some research on the working principle of Alphasense \chem{NO_2} electrochemical sensor had to be made prior to the initialization of the mechanical and electronical sections of this project. The paper /////// on previous experiments conducted in Boston, United States of America was very helpful to get a first idea about how I could start building my project designed for \chem{NO_2} density measurements. In another paper about a research conducted in Zurich, Switzerland, /// it is emphasized that it is quite expensive to build a gas pollutant measurement station sensitive to a certain gas and thus low cost sensor stations play a very important role in collecting environmental data. \par 
My goal was to build a functioning circuit, to get meaningful data from it and to document the entire process of my project well, and the researchs and the papers I read gave me even more motivation about how topical air pollution is and thus how important it is to try to build a low-cost air pollutant density measuring station and to collect useful environmental data.

\section{Getting a Better Understanding}
I had to read the application notes on the Alphasense Webpage to get a better understanding of the inner structure as well as the pinout of the sensor and for this purpose I began to study the /////////////// (kaynak) (inner structure). As I started to understand which electrode of the sensor was responsible for which purpose, I began to get an idea of how I could build my own circuit, which would be able to supply enough current to the sensor and output voltage, linearly proportional to the concentration of the air pollutant, which in other words is the ppb level of \chem{NO_2} in the air. \par
Afterwards I started to read //////////////////(designing a circuit), which gave me a starting point for the circuit. In diagram ////// from //// you can see a circuit design for a three-electrode sensor. I was actaully working with the sensor NO2-B43F, which is a four-electrode sensor, but this circuit schematic was nonetheless a good point to start building and testing the circuit.

\chapter{Putting Into Practice}

\section{Building the Initial Circuit}

\subsection{Hardware}
\subsubsection{Circuit Design}
In order to understand the circuit fully, we must first study the structure and the pinout of the NO2-B43F sensor. There are 4 electrodes of the electrochemical sensor: Working electrode, reference electrode, counter electrode and auxilliary electrode. The reference electrode holds the potential of the working electrode stable at a certain level, which is equal to the potential of the reference electrode itself. This potential must be fixed to ensure a stable outcome from the sensor and the circuit. The counter electrode must be able to supply enough current to the working electrode, so that the current through the counter and working electrode can be translated and amplified to create the output voltage.\par
The A4 and B4 sensors have two sensing electrodes: The working electrode and the auxiliary electrode. The main purpose of the working electrode is to react to the \chem{NO_2} in the air and thus create a current flow proportional to the gas concentration. In other words the working electrode responds to gas concentration whereas the auxiliary electrode does not respond to gas. The idea is to be able to correct for zero drifts using the auxiliary electrode output. It is thus recommended that at the beginning both electrode outputs are recorded (Working electrode and auxiliary electrode) rather than applying a correction directly.\par
The circuit in general comprises of operational amplifiers, a couple of capacitors to reduce noise from the sensor and various resistors to get the desired gain from the operational amplifiers.In Figure ////// the detailed circuit schematic is given. On the left hand side of the circuit the NO2-B43F sensor is connected via 3 electrodes to the circuit. This schematic is for 3 electrode sensors like previously mentioned, so the auxilliary electrode is left out. The power connections of the operational amplifiers are also not shown, however they must be provided a regulated and high enough voltage to encompass the maxima of the output voltage. In addition to that the power supply must be rated with high enough current to be able to supply the required current drawn by the counter electrode and the operational amplifiers themselves.\par
The circuit consists of 2 stages of amplifiers. The first stage is the control circuit, whose main objective is to supply the counter electrode with enough current so that the current required by the working electrode is met. The potential at the reference electrode, namely the reference voltage is connected to the inverting input of the operational amplifier. It is important that near to zero current is drawn from the reference electrode, so an op amp with minimal input bias current is recommended. \textbf{alinti}
Since the current control part of the circuit can already supply the counter electrode with enough current, the next step is to build the sensing part of the circuit, namely the current measuring stage. In this stage, the current through the counter and working electrode flows through the sensing resistor R\textsubscript{Load}, which in return creates a voltage on the inverting input of the second operational amplifier IC1. As it is mentioned before this current through R\textsubscript{Load} is linearly proportional to the gas concentration in the air. As a reminder our main goal is to measure the amplitude of this current created by the working electrode, which gives us information about the concentration of \chem{NO_2}. That is where IC1 comes into play. The voltage difference between the inputs of IC1 is amplified (multiplied) by a very large number and is created on the output of IC1. However this high voltage is fed back to the inverting input over the resistor R4, which increases the voltage on the inverting input and thus reduces the voltage difference between the inputs of the operational amplifier. As a result the output voltage is reduced and so is the influence of the output on the inverting input voltage. This pendulum saturates at a specific voltage level, which is equal to the input voltage multiplied by a constant determined by the resistors R\textsubscript{Load} and R4. This constant i.e. the gain of the amplifier is equal to \textbf{formÃ¼l}. \par
In conclusion the control stage supplies the required current by the counter electrode to the sensor, which is created by the potential difference between the counter and working electrodes. The current then flows through the sensing resistor  R\textsubscript{Load} creating a voltage on the inverting input of IC1. This input voltage is then multiplied by the gain and in the end creates the output voltage.

\subsubsection{Microcontroller}
For this project I decided to use an Arduino Uno board, since it is inexpensive and easy to use. I used a 12 Volts 1 Amp wall adapter for the power supply of the Arduino board. The Arduino board has 5V and 3.3V voltage regulator onboard. Since this circuit does not consist any component which requires high current, the voltage regulation from 12 Volts down to 5 Volts does not dissipate any excessive heat. \par
I put all the parts depicted in the circuit design together on a breadboard. For the power supply needed for the operational amplifiers I simply used the $5V$ and $GND$ power supply lines of the Arduino Uno board. The output of IC1 is connected to the analog input $A0$ on the board, which makes the voltage level readings possible. 


\subsection{Software}
The Arduino Uno board is simply an I/O device with several output and input pins. Through programming via the Arduino Integrated Development Environment (IDE) these pins can be accessed and thus works as an interface between the circuit and the computer. It is capable of reading the voltage connected to its input, sending it to the computer via serial communication. These values sent from the Arduino are then displayed on the computer screen via Arduino Integrated Development Environment (IDE). But in order to let the Arduino board know which data to send and at which frequency, we first have to program it using the same Arduino IDE.\par
Arduino can supply voltage and read voltage inputs up to 5 Volts. Analog inputs of the Arduino divide the continuous voltage range from 0 Volts to the analog reference voltage into 1024 discrete steps while digital outputs with Pulse Width Modulation (PWM) feature can supply 1024 different levels of voltage from 0 Volts up to a maximum of 5 Volts. Digital outputs without this feature can only supply either 0 Volts (LOW) or 5 Volts (HIGH). For this purpose I connected the output pin of the operational amplifier in the last stage to one of the analog inputs on the Arduino. This way I could read the voltage level on the output of the operational amplifier at a high frequency (9600 bits per second) and thus get enough data to plot the output signal with sufficient resolution. \par
For this reason I wrote a simple Arduino code using the Arduino IDE. This code consists of two standart main functions, namely $setup()$ and $loop()$. The $setup$ function is called once when the sketch starts and runs only once after each powerup or reset of the Arduino board \textbf{Arduino setup aliniti}. Afterwards the $loop$ function is called and loops consecutively as the name suggests \textbf{Arduino loop aliniti}. In $setup()$ the serial communication speed, at which the microcontroller Atmega328p of the Arduino Uno is going to communicate with the computer, set with the function $Serial.begin()$ at 9600 bits per second. In $loop$ the function $Serial.print()$ is then used to print the ///////////// values on the serial monitor or on the serial plotter. For testing purposes it is recommended to use the serial monitor embedded in the Arduino IDE, since it is sufficient to show the voltage values at the analog pin on the computer. Alternatively the serial plotter, again embedded in the Arduino IDE, can be used to plot the data and thus to create sample-voltage graph. At the end of the code I added the $delay()$ function, which "[p]auses the program for the amount of time (in milliseconds) specified as parameter." \textbf{delay alinti}. In the code I have written the program waits for 50 milliseconds before acquiring the next value. This way it becomes more pleasant to read the data printed on the serial monitor.

\subsection{Discussion}
This design was a success in terms of testing the sensor and the circuit. The values printed on the serial monitor showed us that the sensor reacted to the \chem{NO_2} concentration in the air. However it was lacking of protection against electrical noise and the values were not similar to the nominal values which were determined with the help of the Individual Sensor Board (ISB) from Alphasense. Most importantly the auxiliiary electrode was left out, which is why a correction for zero drifts was impossible with this circuit design alone. An improvement of the circuit was needed for better results, namely for the output data to get closer to the nominal values of the ISB circuit. Therefore I started to study and eventually build the circuit explained in the next section.  


\section{Realising the Last Circuit}
\subsection{Hardware}
\subsubsection{Circuit Design}

The circuit mainly consists of 3 operational amplifiers, a couple of capacitors to reduce noise from the power supply and various resistors to get the required output voltage to input voltage ratio from each operational amplifier. The circuit and the purpose of its components will be explained in detail in the following section. 


%sokakta test -> discussion

